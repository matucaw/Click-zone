<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <link rel="icon" href="favicon.png" type="image/png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#121212">

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js")
        .then(() => console.log("Service Worker registrado!"))
        .catch(err => console.error("Erro no SW:", err));
    }
  </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>click zone</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #1a1a2e;
      color: #e0e0e0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      box-sizing: border-box;
    }

    canvas {
      background: #0f0f1a;
      border: 2px solid #6a05ad;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(106, 5, 173, 0.7);
      display: block;
      margin-top: 20px;
    }

    #menu {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 30px;
      padding: 25px;
      background: #2a2a4a;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    }

    button {
      padding: 15px 30px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      transition: all 0.3s ease;
      background-color: #6a05ad;
      color: white;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    button:hover {
      background-color: #8a2be2;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(138, 43, 226, 0.4);
    }

    button:active {
      transform: translateY(0);
      box-shadow: none;
      background-color: #5a049d;
    }

    #topGlobal, #comoJogarDiv {
      margin-top: 20px;
      padding: 20px;
      background: #2a2a4a;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      width: 90%;
      max-width: 400px;
      text-align: center;
      font-size: 1.1em;
      line-height: 1.6;
      color: #c0c0c0;
    }
    #topGlobal br, #comoJogarDiv br {
        margin-bottom: 5px;
    }
    #topGlobal strong, #comoJogarDiv strong {
        color: #e0e0e0;
    }

    @media (min-width: 768px) {
      #menu {
        flex-direction: row;
        gap: 25px;
      }
    }
  </style>
</head>
<body>
<div id="menu">
  <button id="btnJogar">Jogar</button>
  <button id="btnTopGlobal">Top Global</button>
  <button id="btnComoJogar">Como Jogar</button>
</div>
<div id="topGlobal"></div>
<div id="comoJogarDiv"></div>
<canvas id="gameCanvas" width="600" height="400"></canvas>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
  import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-analytics.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC9id2pXKJsk-5LVH-o3L4ejWXHwKY0mAE",
    authDomain: "pontos-d5477.firebaseapp.com",
    projectId: "pontos-d5477",
    storageBucket: "pontos-d5477.firebasestorage.app",
    messagingSenderId: "514785770371",
    appId: "1:514785770371:web:c5cba2f049f7bb6e9bd4b6",
    measurementId: "G-YGXCY3JVQF"
  };
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const database = getDatabase(app);

  function criarOuAtualizarPlayer(nick, pontos) {
    const playerRefGlobal = ref(database, 'playersGlobal/' + nick);
    get(playerRefGlobal).then(snap => {
      if (snap.exists()) {
        if (pontos > snap.val().score) set(playerRefGlobal, { score: pontos, lastUpdate: new Date().toISOString() });
      } else set(playerRefGlobal, { score: pontos, lastUpdate: new Date().toISOString() });
    });
  }

  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  let quadrado = { x: 280, y: 180, w: 40, h: 40 };
  let bola = null;
  let pontos = 0;
  let nickDoJogador = "";
  const velocidadeBola = 3;

  const menu = document.getElementById('menu');
  const topGlobalDiv = document.getElementById('topGlobal');
  const comoJogarDiv = document.getElementById('comoJogarDiv');

  function pedirNick() {
    let nick = localStorage.getItem('nickJogador');
    if (!nick) {
      nick = prompt("Digite seu Nick:");
      if (!nick) nick = "Jogador" + Math.floor(Math.random() * 1000);
      localStorage.setItem('nickJogador', nick);
    }
    nickDoJogador = nick;
  }

  function criarNovaBola() {
    const direcoes = ["esq-dir", "dir-esq", "cima-baixo", "baixo-cima"];
    const dir = direcoes[Math.floor(Math.random() * direcoes.length)];
    let x = 0, y = 0, dx = 0, dy = 0;
    switch (dir) {
      case "esq-dir": x = 0; y = quadrado.y + quadrado.h / 2 - 10; dx = velocidadeBola; dy = 0; break;
      case "dir-esq": x = canvas.width - 20; y = quadrado.y + quadrado.h / 2 - 10; dx = -velocidadeBola; dy = 0; break;
      case "cima-baixo": x = quadrado.x + quadrado.w / 2 - 10; y = 0; dx = 0; dy = velocidadeBola; break;
      case "baixo-cima": x = quadrado.x + quadrado.w / 2 - 10; y = canvas.height - 20; dx = 0; dy = -velocidadeBola; break;
    }
    bola = { x, y, w: 20, h: 20, dx, dy, ativa: true };
  }

  function desenhar() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "green"; ctx.fillRect(quadrado.x, quadrado.y, quadrado.w, quadrado.h);
    if (bola && bola.ativa) { ctx.fillStyle = "red"; ctx.fillRect(bola.x, bola.y, bola.w, bola.h); }
    ctx.fillStyle = "white"; ctx.font = "20px sans-serif"; ctx.fillText("Pontos: " + pontos, 10, 30);
  }

  function atualizar() {
    if (bola && bola.ativa) {
      bola.x += bola.dx;
      bola.y += bola.dy;
      if (bola.x > canvas.width || bola.x + bola.w < 0 || bola.y > canvas.height || bola.y + bola.h < 0) {
        bola.ativa = false;
        criarOuAtualizarPlayer(nickDoJogador, pontos);
        location.reload();
        return;
      }
    }
    desenhar();
    requestAnimationFrame(atualizar);
  }

  function iniciarJogo() {
    pontos = 0;
    menu.style.display = "none";
    topGlobalDiv.style.display = "none";
    comoJogarDiv.style.display = "none";
    criarNovaBola();
    requestAnimationFrame(atualizar);
  }

  canvas.addEventListener('click', () => {
    if (!bola || !bola.ativa) return;
    if (bola.x + bola.w / 2 > quadrado.x && bola.x + bola.w / 2 < quadrado.x + quadrado.w &&
      bola.y + bola.h / 2 > quadrado.y && bola.y + bola.h / 2 < quadrado.y + quadrado.h) {
      pontos++;
      criarOuAtualizarPlayer(nickDoJogador, pontos);
      bola.ativa = false;
      criarNovaBola();
    } else {
      criarOuAtualizarPlayer(nickDoJogador, pontos);
      location.reload();
    }
  });

  async function mostrarTopGlobal() {
    topGlobalDiv.innerHTML = "<strong>Top Global:</strong><br>";
    topGlobalDiv.style.display = "block";
    menu.style.display = "none";
    const snapshot = await get(ref(database, 'playersGlobal'));
    if (snapshot.exists()) {
      const lista = Object.entries(snapshot.val()).sort((a, b) => b[1].score - a[1].score).slice(0, 5);
      lista.forEach(([nick, data], i) => { topGlobalDiv.innerHTML += `${i + 1}. ${nick}: ${data.score}<br>`; });
    }
    topGlobalDiv.innerHTML += '<button id="btnVoltarGlobal" style="margin-top: 20px;">Voltar ao Menu</button>';
    document.getElementById('btnVoltarGlobal').addEventListener('click', () => {
      topGlobalDiv.style.display = 'none';
      menu.style.display = 'flex';
    });
  }

  function mostrarComoJogar() {
    comoJogarDiv.innerHTML = "<strong>Como Jogar:</strong><br>" +
      "Seu objetivo é tocar em qualquer parte da tela quando o quadrado vermelho estiver em cima do quadrado verde. " +
      "Faça o máximo de pontos para ficar no Top Global! Se você errar, o jogo reinicia.<br>";
    comoJogarDiv.style.display = "block";
    menu.style.display = "none";

    comoJogarDiv.innerHTML += '<button id="btnVoltarComoJogar" style="margin-top: 20px;">Voltar ao Menu</button>';
    document.getElementById('btnVoltarComoJogar').addEventListener('click', () => {
      comoJogarDiv.style.display = 'none';
      menu.style.display = 'flex';
    });
  }

  document.getElementById('btnJogar').addEventListener('click', iniciarJogo);
  document.getElementById('btnTopGlobal').addEventListener('click', mostrarTopGlobal);
  document.getElementById('btnComoJogar').addEventListener('click', mostrarComoJogar);

  pedirNick();
</script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js')
      .then(() => console.log('Service Worker registrado'));
  }
</script>
</body>
</html>